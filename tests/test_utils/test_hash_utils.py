import pytest
import sys
import os

sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '../..')))

from app.utils.hash_utils import count_repeated_pattern_from_start, get_sha256_hash, convert_hex_to_binary

# Run: pytest -v tests/test_utils/test_hash_utils.py (in cpre directory)


def test_count_repeated_pattern_from_start():
    # Basics
    assert count_repeated_pattern_from_start("000100") == 3
    assert count_repeated_pattern_from_start("111101") == 4
    assert count_repeated_pattern_from_start("010101") == 1
    # Unusual
    assert count_repeated_pattern_from_start("asfuvv") == 1
    assert count_repeated_pattern_from_start("aaaassadv") == 4
    # Edge cases
    assert count_repeated_pattern_from_start("") == 0


def test_get_sha256_hash():
    # Basics
    assert get_sha256_hash("Rare Hashes") == "fac5525e04ec182ce9c05b08a06ba06c69c5e6ab52f94e9217674fed01683e9a"
    assert get_sha256_hash("Hello, World!") == "dffd6021bb2bd5b0af676290809ec3a53191dd81c7f70a4b28688a362182986f"
    # Unusual
    assert get_sha256_hash("Підтримуємо UTF-8") == "17eb9f11943d0e14ef77495125023e82dbbf5a61c1df900a9992dc0da19848b9"
    assert get_sha256_hash(" ") == "36a9e7f1c95b82ffb99743e0c5c4ce95d83c9a430aac59f84ef3cbfab6145068"
    # Edge cases
    assert get_sha256_hash("") == "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855" # Yea, that's the empty string


def test_convert_hex_to_binary():
    # Basics
    assert convert_hex_to_binary("fac5525e04ec182ce9c05b08a06ba06c69c5e6ab52f94e9217674fed01683e9a") == "1111101011000101010100100101111000000100111011000001100000101100111010011100000001011011000010001010000001101011101000000110110001101001110001011110011010101011010100101111100101001110100100100001011101100111010011111110110100000001011010000011111010011010"
    assert convert_hex_to_binary("dffd6021bb2bd5b0af676290809ec3a53191dd81c7f70a4b28688a362182986f") == "1101111111111101011000000010000110111011001010111101010110110000101011110110011101100010100100001000000010011110110000111010010100110001100100011101110110000001110001111111011100001010010010110010100001101000100010100011011000100001100000101001100001101111"
    # Unusual
    assert convert_hex_to_binary("0") == "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
    assert convert_hex_to_binary("123456") == "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100011010001010110"
    assert convert_hex_to_binary("ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff") == "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
    assert convert_hex_to_binary("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF") == "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
    # Raises
    with pytest.raises(ValueError):
        convert_hex_to_binary("hello")
        convert_hex_to_binary("")